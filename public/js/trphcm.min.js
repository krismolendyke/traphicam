(function(a,b){var c=a.document,d=a.navigator,e=a.location,f,g=function(a,b){return function(){return a.apply(b,arguments)}};f=function(){function a(){this.requestRoadList=g(this.requestRoadList,this),this.sendCurrentPosition=g(this.sendCurrentPosition,this),this.load=g(this.load,this),this.socket=new io.Socket,this.socket.on("connect",function(){}),this.socket.on("disconnect",function(){}),this.socket.on("message",g(function(a){var b;b=JSON.parse(a),b.message&&$('div[data-role="content"]').append($("<p>").text(""+b.message.text)),b.currentPosition&&this.load(b);if(b.roadList)return this.loadRoadList(b)},this)),this.socket.connect(),$("a#refresh").live("click",g(function(){return this.sendCurrentPosition()},this)),$("div#follow").live("pageshow",g(function(){return this.sendCurrentPosition()},this)),$("div#roads").live("pageshow",g(function(){return this.requestRoadList()},this))}a.prototype.loadRoadList=function(a){var b,c,d,e;e=a.roadList.roadList;for(c=0,d=e.length;c<d;c++)b=e[c],b.directions.length===0||b.cameraCount===1?$("ul#road-list").append($("script#road-item").tmpl(b)):b.directions.length===2&&$("ul#road-list").append($("script#road-direction-item").tmpl(b));$("ul#road-list").listview("refresh");return $.mobile.pageLoading(!0)},a.prototype.load=function(a){var b,c,d,e,f,g,h,i;a.currentPosition.position.coords.accuracy>2640?b=""+(parseFloat(a.currentPosition.position.coords.accuracy,10)/5280).toFixed(2)+" miles":b=""+a.currentPosition.position.coords.accuracy+" feet",d=new Date(a.currentPosition.position.timestamp),e=d.toLocaleTimeString(),$("p#stats").empty().text("It looks like you're at\n("+a.currentPosition.position.coords.latitude+", "+a.currentPosition.position.coords.longitude+"), within an accuracy of "+b+" and that there's at least "+a.currentPosition.cameras.results.length+" cameras within a distance of "+a.currentPosition.cameras.maxDistance+" miles at "+d+"."),i=a.currentPosition.cameras.results;for(g=0,h=i.length;g<h;g++)c=i[g],c.obj.url.indexOf(!1)?f="?t="+Date.now():f="&t="+Date.now(),c.obj.url=""+c.obj.url+f,c.time=e,$("ul#cam-list").append($("script#cam-item").tmpl(c));$("ul#cam-list").listview("refresh");return $.mobile.pageLoading(!0)},a.prototype.sendCurrentPosition=function(){if(d.geolocation){$.mobile.pageLoading(),$("ul#cam-list").empty();return d.geolocation.getCurrentPosition(g(function(a){return this.socket.send(JSON.stringify({currentPosition:{position:a}}))},this),g(function(a){},this))}return this.socket.send(JSON.stringify({error:{message:"Geolocation unsupported."}}))},a.prototype.requestRoadList=function(){$.mobile.pageLoading(),$("ul#road-list").empty();return this.socket.send(JSON.stringify({roadList:{message:"cool"}}))};return a}(),a.trphcm=f})(window),$(function(){return new trphcm})