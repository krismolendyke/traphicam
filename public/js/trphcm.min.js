(function(a,b){var c=a.document,d=a.navigator,e=a.location,f,g,h,i=function(a,b){return function(){return a.apply(b,arguments)}};h=function(){function a(){$("div#road").live("pageshow",i(function(){if(!this.road)return this.road=new g(this)},this)),$("div#nearby").live("pageshow",i(function(){this.nearby||(this.nearby=new f(this));return this.nearby.sendCurrentPosition()},this))}return a}(),g=function(){function a(a){this.trphcm=a,$("a#refresh-road").removeClass("ui-disabled").live("tap",this.refresh)}a.prototype.refresh=function(){var a;$(this).addClass("ui-disabled"),setTimeout(function(){return $("a#refresh-road").removeClass("ui-disabled")},5e3),a=Date.now();return $("div#road").find("ul.cam-list").find("img").each(function(){var b;b=$(this).attr("src"),b=""+b.slice(0,b.indexOf("t="))+"t="+a;return $(this).attr("src",b)})};return a}(),f=function(){function a(a){this.trphcm=a,this.sendCurrentPosition=i(this.sendCurrentPosition,this),this.load=i(this.load,this),this.socket=new io.Socket,this.socket.on("message",i(function(a){var b;b=JSON.parse(a),b.message&&$('div[data-role="content"]').append($("<p>").text(""+b.message.text));if(b.currentPosition)return this.load(b)},this)),this.socket.connect(),$("a#refresh").live("tap",i(function(){return this.sendCurrentPosition()},this))}a.prototype.load=function(a){var b,c,d,e,f,g,h,i;a.currentPosition.position.coords.accuracy>2640?b=""+(parseFloat(a.currentPosition.position.coords.accuracy,10)/5280).toFixed(2)+" miles":b=""+a.currentPosition.position.coords.accuracy+" feet",d=new Date(a.currentPosition.position.timestamp),e=d.toLocaleTimeString(),$("p#stats").empty().text("It looks like you're at\n("+a.currentPosition.position.coords.latitude+", "+a.currentPosition.position.coords.longitude+"), within an accuracy of "+b+" and that there's at least "+a.currentPosition.cameras.results.length+" cameras within a distance of "+a.currentPosition.cameras.maxDistance+" miles of you."),i=a.currentPosition.cameras.results;for(g=0,h=i.length;g<h;g++)c=i[g],c.obj.url.indexOf(!1)?f="?t="+Date.now():f="&t="+Date.now(),c.obj.url=""+c.obj.url+f,c.time=e,$("ul#cam-list").append($("script#cam-item").tmpl(c));$("ul#cam-list").listview("refresh");return $.mobile.pageLoading(!0)},a.prototype.sendCurrentPosition=function(){if(d.geolocation){$.mobile.pageLoading(),$("ul#cam-list").empty();return d.geolocation.getCurrentPosition(i(function(a){return this.socket.send(JSON.stringify({currentPosition:{position:a}}))},this),i(function(a){},this))}return this.socket.send(JSON.stringify({error:{message:"Geolocation unsupported."}}))};return a}(),a.trphcm=h})(window),$(function(){return new trphcm})